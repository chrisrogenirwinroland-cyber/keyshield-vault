{{ define "keyshield.email.html" }}
<html>
  <body style="font-family: Arial, sans-serif; font-size: 14px; color:#111;">
    <h2 style="margin:0 0 10px 0;">Keyshield Monitoring Alert</h2>

    <p style="margin:0 0 10px 0;">
      <b>Status:</b> {{ .Status | toUpper }}<br/>
      <b>Alert:</b> {{ .CommonLabels.alertname }}<br/>
      {{ if .CommonLabels.severity }}<b>Severity:</b> {{ .CommonLabels.severity }}<br/>{{ end }}
      {{ if .CommonLabels.team }}<b>Team:</b> {{ .CommonLabels.team }}<br/>{{ end }}
    </p>

    {{ if .CommonAnnotations.summary }}
      <p style="margin:0 0 6px 0;"><b>Summary:</b> {{ .CommonAnnotations.summary }}</p>
    {{ end }}

    {{ if .CommonAnnotations.description }}
      <p style="margin:0 0 12px 0;"><b>Description:</b> {{ .CommonAnnotations.description }}</p>
    {{ end }}

    <hr/>

    <h3 style="margin:12px 0 6px 0;">Quick Links</h3>
    <ul>
      <li>
        <b>Prometheus Expression (GeneratorURL):</b>
        see per-alert links in the "Alert Instances" section
      </li>
      <li>
        <b>Grafana Dashboard:</b>
        <a href="http://localhost:3001" target="_blank">http://localhost:3001</a>
      </li>
    </ul>

    <h3 style="margin:12px 0 6px 0;">Alert Instances ({{ len .Alerts }})</h3>

    {{ range .Alerts }}
      <div style="border:1px solid #ddd; padding:10px; margin:10px 0; border-radius:6px;">
        <p style="margin:0 0 6px 0;">
          <b>{{ .Labels.alertname }}</b>
          {{ if .Labels.instance }} — {{ .Labels.instance }}{{ end }}
          {{ if .Labels.job }} (job: {{ .Labels.job }}){{ end }}
        </p>

        {{ if .Annotations.summary }}
          <p style="margin:0 0 4px 0;"><b>Summary:</b> {{ .Annotations.summary }}</p>
        {{ end }}
        {{ if .Annotations.description }}
          <p style="margin:0 0 8px 0;"><b>Description:</b> {{ .Annotations.description }}</p>
        {{ end }}

        <p style="margin:0 0 4px 0;">
          <b>Starts At:</b> {{ .StartsAt }}<br/>
          {{ if .EndsAt }}<b>Ends At:</b> {{ .EndsAt }}<br/>{{ end }}
        </p>

        {{ if .GeneratorURL }}
          <p style="margin:0;">
            <b>Prometheus Query Link:</b>
            <a href="{{ .GeneratorURL }}" target="_blank">{{ .GeneratorURL }}</a>
          </p>
        {{ end }}
      </div>
    {{ end }}

    <p style="color:#666; font-size:12px;">
      This message was generated by Alertmanager for the Keyshield monitoring stack.
    </p>
  </body>
</html>
{{ end }}
